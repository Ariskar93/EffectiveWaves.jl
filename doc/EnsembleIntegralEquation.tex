\pdfoutput=1

\documentclass[12pt, a4paper]{article}
\usepackage[utf8]{inputenc}

\usepackage[style= bwl-FU, backend = biber, maxbibnames=99, maxcitenames=2,uniquelist=minyear, firstinits=true]{biblatex}

% \AtEveryBibitem{\clearfield{number}}
% \AtEveryBibitem{\clearfield{doi}}
\AtEveryBibitem{\clearfield{note}}
\AtEveryBibitem{\clearfield{urldate}}
\AtEveryBibitem{\clearfield{issn}}
\AtEveryBibitem{\clearfield{isbn}}
%
\addbibresource{Library.bib}

\usepackage{authblk}
\usepackage{color,graphicx,tikz}
\usetikzlibrary{positioning,arrows}
% The amssymb package provides various useful mathematical symbols
\usepackage{mathtools,amssymb,amsmath,mathdots,amsfonts}
\usepackage[mathscr]{eucal} %just for the font \mathscr
\usepackage{enumerate}
%\usepackage{amsthm}
%\usepackage{mathaccents}
\usepackage{setspace}
\newtheorem{remark}{Remark} [section]
\usepackage{hyperref}

\input{mst-macros}
\input{macros}

% \graphicspath{{../images/}}
%\graphicspath{{Media/}}

\doublespacing
% \setlength{\topmargin}{0cm} \addtolength{\textheight}{2cm}
\evensidemargin=0cm \oddsidemargin=0cm \setlength{\textwidth}{16cm}

\begin{document}

\title{Numerically solving integral equations of wave ensembles}

% \author{
% Artur L. Gower$^{a}$, Michael J. A. Smith$^{a}$, \\ William Parnell$^{a}$ and David Abrahams$^{a,b}$ \\[12pt]
% \footnotesize{$^{a}$ School of Mathematics, University of Manchester, Oxford Road, Manchester, M13 9PL, UK}\\
% \footnotesize{$^{b}$ Isaac Newton Institute for Mathematical Sciences, 20 Clarkson Rd, Cambridge CB3 0EH, UK}
% }

\author[$\dagger$]{Artur L.\ Gower}

\affil[$\dagger$]{School of Mathematics, University of Manchester, Oxford Road, Manchester M13 9PL, UK}

\date{\today}
\maketitle

\begin{abstract}
Allows for a broad frequency range, and to easily test different statistical assumptions. Assumptions such as the pair-correlation and QCA.
\end{abstract}

\noindent
{\textit{Keywords:} polydisperse, multiple scattering, Fredholm Integral equations, multi-species, effective waves, quasicrystalline approximation, statistical methods}


\section{Effective waves for uniformly distributed species}
\label{sec:results}

We consider a halfspace $x>0$ filled with $S$ types of inclusions (species) that are uniformly distributed. The fields are governed by the scalar wave equation:
\begin{align}
  &\nabla^2 u + k^2 u = 0, \quad \text{(in the background material)} \\
  &\nabla^2 u + k^2_j u = 0, \quad \text{(inside the $j$-th scatterer)},
\end{align}
 The background and species material properties are summarised in Table~\ref{tab:properties}.
The goal is to calculate how a medium with these scatterers, randomly uniformly distributed, reflects and transmits waves in an
\href{https://en.wikipedia.org/wiki/Ensemble_average_(statistical_mechanics)}{ensemble average sense}.

For simplicity we will consider that all particles are cylindrical, though it is easy to extend the results to any smooth particle by using Waterman's T-matrix\cite{waterman_symmetry_1971,varadan_multiple_1978,mishchenko_t-matrix_1996}.

\input{table_properties.tex}

\section{Cylindrical species}

We consider an incident wave
\begin{gather}
  u_\inc =  \ee^{\ii \mathbf k \cdot \mathbf x} \quad \text{with} \quad \mathbf k \cdot \mathbf x = k x \cos \theta_\inc  + k y \sin \theta_\inc,
%   u_\inc(x,y) = \ee^{\ii \mathbf k \cdot \mathbf x}, \quad \text{with} \quad \mathbf k \cdot \mathbf x = \alpha  x  + \beta y,
% \notag \\
%   \text{where} \qquad  \alpha = k \cos \theta_\inc, \quad \beta = k \sin \theta_\inc,
  \label{eqns:incident}
\end{gather}
and angle of incidence $\theta_\inc$ from the $x$-axis, exciting a material occupying the halfspace $x>0$.

Combining equations (3.6) and the quasicrystalline approximation (3.10) from \parencite{gower_reflection_2018}, we arrive at
\begin{multline}
 \sum_{n=-\infty}^\infty \int_\regS \int_{\stackrel{x_2 > 0 }{\|\mathbf x_1 - \mathbf x_2 \| > a_{12}}}  \A n (\mathbf x_2, \s_2) F_{n-m}(k\mathbf x_2 - k \mathbf x_1,k)  d \mathbf x_2 d\s_2^n
\\
+  \A m (\mathbf x_1, \s_1) + \ee^{\ii \mathbf x_1 \cdot \mathbf k } \ee^{\ii m ( \pi/2 - \theta_\inc )}
   = 0, \quad \text{for} \quad x_1 >0,
  \label{eqn:ensemAsystem}
\end{multline}
where
\begin{align}
  & d\s_2^n = \nfrac {} \scatZ_n (\s_2) p(\s_2) d\s_2,
  \\
  & F_{n}(\mathbf X,k) = (-1)^{n}\ee^{\ii n \Theta} H_{n}(R)( 1 + g(R/k;  \s_1,\s_2)),
  \label{eqn:integral_kernel}
\end{align}
with $(R,\Theta)$ being the polar coordinates of $\mathbf X = (X,Y)$,
$p(\s_1)$ is the probability density function of picking a species in $\regS$ and we assumed statistical independence $p(\s_1, \s_2) = p(\s_1)p(\s_2)$. The function $g(R; \s_1,\s_2)$ is the pair-correlation, assuming $R$ is the distance between two particles, one centred of type $\s_1$ and another of type $\s_2$. If we were to use whole correction, then $g(R; \s_1,\s_2) = 0$.
For most random systems we expect that rapidly $g(R; \s_1,\s_2) \to 0$ as $R \to \infty$, so we will assume
\begin{equation}
  g(R; \s_1,\s_2) = 0, \quad \text{ for } \; R > \bar a_{12}.
  \label{eqn:pair_correlation}
\end{equation}
In terms of the notation from \parencite{gower_reflection_2018}:
\begin{multline}
  |\reg| p(\Lam 2 | \Lam 1) = |\reg|^2 \frac{p(\Lam 1, \Lam 2)}{p(\s_1)} = |\reg|^2 p(\s_2) p(\mathbf x_1, \mathbf x_2 | \s_1,\s_2)
  \\ = p(\s_2)(1 + g(\|\mathbf x_1 - \mathbf x_2\|;  \s_1,\s_2)).
\end{multline}

For computational efficiency, we will change variables to
\begin{align}
& X = k\mathbf x_2 - k\mathbf x_1, \quad (x,y) = (kx_1,ky_1),
% \\
% & b = a_{12}}, \quad  \bar b = \bar a_{12}}, \quad  \s_2 = \s_2, \quad  \s_1 = \s_{},
\end{align}
% where the last line is just to have a consistent notation.
We also borrow equation (4.1) from \parencite{gower_reflection_2018} to substitute
\[
\A m (x, y, \s) = \A m (x, \s) \ee^{\ii y k \sin\theta_\inc},
\]
which is due to the symmetry of~\eqref{eqn:ensemAsystem}. Substituting the above into~\eqref{eqn:ensemAsystem}, we can rewrite the integrated term:
\begin{align*}
   \frac{k^2}{\ee^{\ii y \sin\theta_\inc}} & \int_{\stackrel{x_2 > 0 }{\|\mathbf x_2-\mathbf x_1 \| > a_{12}}} \A n (x_2, \s_2) \ee^{\ii y_2 k \sin\theta_\inc} F_{n-m}(k\mathbf x_2 - k \mathbf x_1,k) d \mathbf x_2
  \\
  &=\int_{X> -x} \A n (X/k + x/k, \s_2) \int_{Y^2 > k^2 a_{12}^2 - X^2}
   \ee^{\ii Y \sin\theta_\inc} F_{n-m}(\mathbf X,k) d Y d X,
\end{align*}
then we split the integral on the right in the form
\begin{align*}
  &\int_{Y^2 > k^2 a_{12}^2 - X^2} \ee^{\ii Y \sin\theta_\inc} F_{n-m}(\mathbf X,k) d Y
 = \chi_{\{ |X|< k a_{12}\}} \int_{-\infty}^{\infty} \chi_{\{ Y^2> k^2 a_{12}^2 - X^2\}} \ee^{\ii Y \sin\theta_\inc}
  F_{n-m}(\mathbf X,k) d Y
  \\
  & +  \chi_{\{ |X|> k a_{12}\}}S_{n-m}(X,k),
\end{align*}
where
\begin{equation}
  S_n(X,k) =  \int_{-\infty}^\infty \ee^{\ii Y \sin\theta_\inc}
  F_{n}(\mathbf X,k) d Y = \frac{2 \ii^{n} \ee^{-\ii n \theta_\inc}}{\cos \theta_\inc} \ee^{\ii X \cos \theta_\inc }
  % \int_{-\infty}^\infty \ee^{\ii y_2 k \sin\theta_\inc} \ee^{\ii (n-m) \Theta_{12}} H_{n-m}(k R_{12})d y_2
  % \\
  % + (-1)^{n-m} \int_{y_2 \in B(\bar a_{12}})} \ee^{\ii y_2 k \sin\theta_\inc} \ee^{\ii (n-m) \Theta_{12}} H_{n-m}(k R_{12})g(\|\mathbf x_1 - \mathbf x_2\|;  \s_1,\s_2) d y_2
  + G_{n}(X, k),
\end{equation}
by using~\eqref{eqn:pair_correlation}, equation (B.3) from \cite{gower_reflection_2018}, and defining
\begin{multline}
G_n(X, k) = (-1)^{n} \int_{-\sqrt{k^2 \bar a_{12}^2 - X^2}}^{\sqrt{k^2\bar a_{12}^2 - X^2}} \ee^{\ii Y \sin\theta_\inc}
  \ee^{\ii n \Theta} H_{n}(R)g(R/k;  \s_1,\s_2) d Y
  \\ = 2 (-1)^{n} \int_{0}^{\sqrt{k^2\bar a_{12}^2 - X^2}} \cos\left(Y \sin\theta_\inc + n \Theta\right) H_{n}(R)g(R/k;  \s_1,\s_2) d Y
\end{multline}
We also need the integral
\begin{multline}
  B_n(X,k) = \int_{-\infty}^{\infty} \chi_{\{ Y^2> k^2 a_{12}^2 - X^2\}} \ee^{\ii Y \sin\theta_\inc}
   F_{n}(\mathbf X,k) d Y
  \\
  = 2(-1)^{n} \int_{\sqrt{k^2 a_{12}^2 - X^2}}^\infty \cos \left( Y \sin\theta_\inc +  n \Theta\right) H_{n}(R)( 1 + g(R/k;  \s_1,\s_2)) d Y.
\end{multline}
It is difficult to numerically integrate the above because the integrand tends to zero very slowly as $Y$ increases. To numerically integrate the above we use
\begin{align}
  & \cos \left( Y \sin\theta_\inc +  n \Theta\right) = \cos((n \pi)/2 + Y \sin(\theta_\inc)) + \mathcal O(X/Y),
  \\
  & H_{n}(R) =  -(-1)^{3/4} \ee^{-\ii n \pi /2} \sqrt{\frac{2}{\pi Y}} + \mathcal O(X^{3/2}/Y^{3/2}),
\end{align}
which we use to rewrite
\begin{multline}
  B_n(X,k) = 2(-1)^{n} \int_{\sqrt{k^2 a_{12}^2 - X^2}}^{Y_1} \cos \left( Y \sin\theta_\inc +  n \Theta\right) H_{n}(R)( 1 + g(R/k;  \s_1,\s_2)) d Y
  \\ + \frac{1 + \ii}{\sqrt{\pi Y_1} \cos(\theta_\inc)^2} \ee^{\ii  Y_1 (1 - \sin(\theta_\inc))}
  \left[ 1 + (-1)^n \ee^{2 \ii Y_1 \sin(\theta_\inc)} (1 - \sin(\theta_\inc)) + \sin(\theta_\inc) \right] + \mathcal O(X/Y),
\end{multline}
where we assumed that $g(R/k;  \s_1,\s_2) =0$ for $Y>Y_1$.

Written in full the governing equation~\eqref{eqn:ensemAsystem} now becomes
\begin{multline}
 \sum_{n=-\infty}^\infty \int_\regS
  \int_{X> 0} \A n (X/k, \s_2) K(X - x,k) dX
  d\s_2^n
\\
+  k^2 \A m (x/k, \s_1)   + k^2  \ee^{\ii x \cos \theta_\inc} \ee^{\ii m ( \pi/2 - \theta_\inc )}
   = 0, \quad \text{for} \quad x_1 >0,
  \label{eqn:ensemAsystem2}
\end{multline}
where I swapped the integration variable $X \to X - x$.
% Uncomment to see in full
% \begin{align*}
%    \frac{k^2}{\ee^{\ii y \sin\theta_\inc}} & \int_{\stackrel{x_2 > 0 }{\|\mathbf x_2-\mathbf x_1 \| > a_{12}}} \A n (x_2, \s_2) \ee^{\ii y_2 k \sin\theta_\inc} F_{n-m}(k\mathbf x_2 - k \mathbf x_1,k) d \mathbf x_2
%   \\
%   &=\int_{X> -x} \A n (X/k + x/k, \s_2)
%   \chi_{\{ |X|< k a_{12}\}}   B_{n-m}(X,k)
%    d X,
%   \\
%   & +\int_{X> -x} \A n (X/k + x/k, \s_2)
%   \chi_{\{ |X|> k a_{12}\}} \left [G_{n-m}(X, k) + \frac{2 \ii^{n-m} \ee^{-\ii(n-m) \theta_\inc}}{\cos \theta_\inc} \ee^{\ii X \cos \theta_\inc } \right ]
%    d X,
% \end{align*}
where
\begin{multline}
K(X-x,k) =   \chi_{\{ |X-x|> k a_{12}\}}  S_{n-m}(X-x,k)
% \left [G_{n-m}(X-x, k) + \frac{2 \ii^{n-m} \ee^{-\ii(n-m) \theta_\inc}}{\cos \theta_\inc} \ee^{\ii (X - x) \cos \theta_\inc } \right ]
% \\
 + \chi_{\{ |X - x|< k a_{12}\}}   B_{n-m}(X- x,k).
\label{eqn:kernel}
\end{multline}
Numerically it is better to substitute in the above to reach
\begin{multline}
 2 \frac{ \ee^{-\ii x \cos \theta_\inc } }{ \cos \theta_\inc} \sum_{n=-\infty}^\infty \int_\regS
  \int_{\stackrel{|X-x|> k a_{12}}{X>0}} \A n (X/k, \s_2)  \ii^{n-m} \ee^{-\ii(n-m) \theta_\inc} \ee^{\ii X \cos \theta_\inc } dX
  d\s_2^n
  \\
 +  \sum_{n=-\infty}^\infty \int_\regS
  \int_{\stackrel{|X-x|> k a_{12}}{X>0}} \A n (X/k, \s_2) G_{n-m}(X-x, k) dX
  d\s_2^n
  \\
  +  \sum_{n=-\infty}^\infty \int_\regS
    \int_{\stackrel{|X-x| < k a_{12}}{X>0}} \A n (X/k, \s_2) B_{n-m}(X- x,k) dX
    d\s_2^n
\\
+  k^2 \A m (x/k, \s_1)   + k^2  \ee^{\ii x \cos \theta_\inc} \ee^{\ii m ( \pi/2 - \theta_\inc )}
   = 0, \quad \text{for} \quad x_1 >0,
  \label{eqn:ensemAsystem3}
\end{multline}


To start, by solving the single species and consider only whole correction pair-correlation. After trying methods based on Chebyshev and function approximation, I've decided they are too computationally intense. For this reason I'm going with a simpler discretization: let $\A n^j = \A n (X_j/k)$ where $X_j = j h$ for $j=0,\ldots,N$. A regular spaced mesh is best because of the convolution. For the other fields we use, for example, $S_n^j = S_n(j h)$. Then we will use the vectors:
\begin{equation}
  \vec \Ab_n = (\Ab_n^j)_j, \quad \vec S_n = (S_n^j)_j, \quad \vec B_n = (B_n^j)_j, \quad \vec b_n = - k^2(\ee^{ \ii j h \cos \theta_\inc} \ee^{\ii n ( \pi/2 - \theta_\inc )})_j.
\end{equation}


\begin{multline}
  \ee^{-\ii x \cos \theta_\inc } \sum_{n=-\infty}^\infty
  \int_{X>0} \A n (X/k) S_{n-m}(X) dX
  d\s_2^n
  \\
  +  \sum_{n=-\infty}^\infty
    \int_{\stackrel{|X-x| < k a_{12}}{X>0}} \A n (X/k) (B_{n-m}(X- x,k) - S_{n-m}(X-x) )dX
    d\s_2^n
\\
+  k^2 \A m (x/k)   + k^2  \ee^{\ii x \cos \theta_\inc} \ee^{\ii m ( \pi/2 - \theta_\inc )}
   = 0, \quad \text{for} \quad x_1 >0,
  \label{eqn:ensemAsystem4}
\end{multline}
\begin{multline}
  \nfrac {} \ee^{-\ii x_\ell \cos \theta_\inc } \sum_{n,j \geq 0}  \scatZ_n  \sigma_j \Ab_n^j S_{n-m}^j
  \\
  +  \nfrac {}  \sum_{n, j \geq 0, |j-\ell|\leq p} \scatZ_n  \sigma_j \Ab_n^j (B_{n-m}^{j-\ell} - S_{n-m}^{j -\ell} )
+  k^2  \Ab_m^\ell
   =  b_m^\ell,
  \label{eqn:ensemAsystemN}
\end{multline}
for $\ell >0$, where $p = \lfloor k a_{12}/h \rfloor$, and $\sigma_j$ repesents the discrete integral. In matrix form,
\begin{equation}
  \nfrac {} \sum_{n}  \scatZ_n ( \vec P_{n-m} + \vec Q_{n-m}) \vec \Ab_n
+  k^2 \vec I \vec \Ab_m  =  \vec b_m,
  \label{eqn:ensemAsystemN2}
\end{equation}
where we used the matrices:
\begin{equation}
  P_{n-m}^{\ell j} =  \ee^{-\ii x_\ell \cos \theta_\inc } \sigma_j S_{n-m}^j, \quad Q_{n-m}^{\ell j} = \sigma_j (B_{n-m}^{j-\ell} - S_{n-m}^{j -\ell} ) \chi_{\{|j-\ell| \leq p\}},
\end{equation}
where $j,\ell = 0,1, \ldots, N$. Finally in block-matrix form: $\vec M \vec \Ab  =  \vec b$, where
\begin{align}
&\vec M_{mn} = \nfrac {} \scatZ_n ( \vec P_{n-m} + \vec Q_{n-m})+  k^2 \delta_{mn} \vec I,
\\
& \vec \Ab = [ \vec \Ab_{-M}, \vec \Ab_{1-M}, \cdots, \vec \Ab_{M-1}, \vec \Ab_{M}]^T,
\\
& \vec b = [ \vec b_{-M}, \vec b_{1-M}, \cdots, \vec b_{M-1}, \vec b_{M}]^T.
  \label{eqn:ensemAsystemB}
\end{align}

\printbibliography

% \bibliographystyle{RS}
% \bibliography{../Library2}

\end{document}
